<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cotizador de Puntos de Venta</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <style>
        :root {
            --primary: #3498db;
            --secondary: #2c3e50;
            --success: #2ecc71;
            --danger: #e74c3c;
            --warning: #f39c12;
            --light: #ecf0f1;
            --dark: #34495e;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: var(--dark);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .quote-section {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
        }
        
        .services {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        
        .service-category {
            margin-bottom: 30px;
        }
        
        .service-category h3 {
            color: var(--secondary);
            border-bottom: 2px solid var(--primary);
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        
        .service-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #eee;
        }
        
        .service-info {
            flex: 1;
        }
        
        .service-name {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .service-desc {
            font-size: 0.9rem;
            color: #7f8c8d;
        }
        
        .service-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .quantity {
            width: 60px;
            padding: 8px;
            text-align: center;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        .checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        
        .price {
            font-weight: 600;
            min-width: 80px;
            text-align: right;
        }
        
        .summary {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            position: sticky;
            top: 20px;
        }
        
        .summary h3 {
            color: var(--secondary);
            margin-bottom: 20px;
            text-align: center;
        }
        
        .summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .summary-total {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary);
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid var(--primary);
        }
        
        .btn-generate {
            display: block;
            width: 100%;
            padding: 15px;
            background: var(--success);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            transition: background 0.3s;
        }
        
        .btn-generate:hover {
            background: #27ae60;
        }
        
        .additional-options {
            margin-top: 30px;
        }
        
        .additional-options h4 {
            margin-bottom: 15px;
            color: var(--secondary);
        }
        
        .option-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .client-form {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
        }
        
        .client-form h3 {
            color: var(--secondary);
            margin-bottom: 20px;
            border-bottom: 2px solid var(--primary);
            padding-bottom: 10px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--secondary);
        }
        
        input[type="text"],
        input[type="email"],
        input[type="tel"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .btn-pdf {
            background: var(--danger);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            font-weight: 600;
            cursor: pointer;
            flex: 1;
            transition: background 0.3s;
        }
        
        .btn-pdf:hover {
            background: #c0392b;
        }
        
        .btn-email {
            background: var(--warning);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            font-weight: 600;
            cursor: pointer;
            flex: 1;
            transition: background 0.3s;
        }
        
        .btn-email:hover {
            background: #e67e22;
        }
        
        .btn-reset {
            background: #95a5a6;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            font-weight: 600;
            cursor: pointer;
            flex: 1;
            transition: background 0.3s;
        }
        
        .btn-reset:hover {
            background: #7f8c8d;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .modal h3 {
            margin-bottom: 15px;
            color: var(--secondary);
        }
        
        .modal p {
            margin-bottom: 20px;
        }
        
        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .btn-ok {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .quote-section {
                grid-template-columns: 1fr;
            }
            
            .summary {
                position: static;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .form-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Cotizador de Puntos de Venta</h1>
            <p class="subtitle">Selecciona los servicios que necesitas para tu negocio</p>
        </header>
        
        <div class="client-form">
            <h3>Datos del Cliente</h3>
            <div class="form-row">
                <div class="form-group">
                    <label for="company-name">Nombre de la Empresa</label>
                    <input type="text" id="company-name" placeholder="Ingresa el nombre de la empresa">
                </div>
                <div class="form-group">
                    <label for="company-rfc">RFC</label>
                    <input type="text" id="company-rfc" placeholder="Ingresa el RFC">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="contact-name">Nombre de Contacto</label>
                    <input type="text" id="contact-name" placeholder="Nombre completo">
                </div>
                <div class="form-group">
                    <label for="contact-email">Email</label>
                    <input type="email" id="contact-email" placeholder="correo@empresa.com">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="contact-phone">Teléfono</label>
                    <input type="tel" id="contact-phone" placeholder="Número de teléfono">
                </div>
                <div class="form-group">
                    <label for="quote-validity">Validez de Cotización (días)</label>
                    <input type="text" id="quote-validity" value="30">
                </div>
            </div>
        </div>
        
        <div class="quote-section">
            <div class="services">
                <div class="service-category">
                    <h3>Puntos de Venta</h3>
                    <p>Todos los sistemas gestionan ventas, impresión de ticket, administración de productos, control de inventarios, reporteria y corte de caja. Se puede personalizar al branding de su negocio.</p>
                    
                    <div class="service-item">
                        <div class="service-info">
                            <div class="service-name">Punto de Venta de Escritorio</div>
                            <div class="service-desc">Sistema para cualquier computadora o laptop.</div>
                        </div>
                        <div class="service-controls">
                            <input type="number" class="quantity" id="desktop-qty" min="0" value="1">
                        </div>
                        <div class="price" id="desktop-price">$3,800.00</div>
                    </div>
                    
                    <div class="service-item">
                        <div class="service-info">
                            <div class="service-name">Punto de Venta Web</div>
                            <div class="service-desc">Plataforma online para ventas con acceso a cualquier dispositivo desde cualquier navegador.</div>
                        </div>
                        <div class="service-controls">
                            <input type="number" class="quantity" id="web-qty" min="0" value="0">
                        </div>
                        <div class="price" id="web-price">$4,500.00</div>
                    </div>

                    <div class="service-item">
                        <div class="service-info">
                            <div class="service-name">Punto de Venta Móvil</div>
                            <div class="service-desc">Aplicación para tablet o smartphone para ventas en cualquier lugar.</div>
                        </div>
                        <div class="service-controls">
                            <input type="number" class="quantity" id="mobile-qty" min="0" value="0">
                        </div>
                        <div class="price" id="mobile-price">$5,000.00</div>
                    </div>
                </div>
                
                <div class="service-category">
                    <h3>Costos adicionales</h3>
                    <p>Si se desea un sistema que pueda ser consultado desde cualquier dispositivo se recomienda adquirir la versión móvil y web, 
                        ya que permite tener la información en tiempo real y los sistemas se pueden conectar entre sucursales, para ello se requiere la adquisión de estos servicios adicionales y externos. 
                        El precio puede varios ya que siempre hay ofertas constantes:</p>
                    
                    <div class="service-item">
                        <div class="service-info">
                            <div class="service-name">Servidor VPS</div>
                            <div class="service-desc">Servidor alojar la base de datos del sistema (costo anual)</div>
                        </div>
                        <div class="service-controls">
                            <input type="checkbox" class="checkbox" id="vps-check">
                        </div>
                        <div class="price" id="vps-price">$3,500.00/año</div>
                    </div>
                    
                    <div class="service-item">
                        <div class="service-info">
                            <div class="service-name">Dominio Web</div>
                            <div class="service-desc">Registro de dominio personalizado por un año, incluye correos con nombre de su negocio.</div>
                        </div>
                        <div class="service-controls">
                            <input type="checkbox" class="checkbox" id="domain-check">
                        </div>
                        <div class="price" id="domain-price">$1,000.00/año</div>
                    </div>
                </div>
                
                <div class="additional-options">
                    <h4>Opciones Adicionales</h4>
                    
                    <div class="option-item">
                        <div class="service-info">
                            <div class="service-name">Soporte Técnico</div>
                            <div class="service-desc">Todo sistema cuenta con 6 meses de garantía, en caso de tener problemas con el sistema por error humano del personal se tendría un costo dependiendo el tiempo de solución, este es cobrado por hora.</div>
                        </div>
                        <div class="service-controls">
                            <input type="checkbox" class="checkbox" id="support-check">
                        </div>
                        <div class="price" id="support-price">$100.00/hora</div>
                    </div>

                    <div class="option-item">
                        <div class="service-info">
                            <div class="service-name">Instalación y configuración en equipos adicionales</div>
                            <div class="service-desc">La adquisición del punto de venta avala 3 dispositivos, por lo cual si se requiere la instalacion en más dispositivos:</div>
                        </div>
                        <div class="service-controls">
                            <input type="number" class="quantity" id="devices-qty" min="0" value="0">
                        </div>
                        <div class="price" id="extra-device-price">$350.00 c/u</div>
                    </div>
                    
                    <div class="option-item">
                        <div class="service-info">
                            <div class="service-name">Capacitación Personalizada</div>
                            <div class="service-desc">Se instruye a su personal para el uso del sistema y equipo. La adquisión del sistema le avala a todo su personal, pero si requiere en un futuro la capacitación el costo sería el siguiente:</div>
                        </div>
                        <div class="service-controls">
                            <input type="number" class="quantity" id="training-qty" min="0" value="0">
                        </div>
                        <div class="price" id="training-price">$350.00/sesión</div>
                    </div>
                </div>
            </div>
            
            <div class="summary">
                <h3>Resumen de Cotización</h3>
                
                <div class="summary-item">
                    <span>Punto de Venta Escritorio:</span>
                    <span id="summary-desktop">$3,800.00</span>
                </div>
                
                <div class="summary-item">
                    <span>Punto de Venta Móvil:</span>
                    <span id="summary-mobile">$0.00</span>
                </div>
                
                <div class="summary-item">
                    <span>Punto de Venta Web:</span>
                    <span id="summary-web">$0.00</span>
                </div>
                
                <div class="summary-item">
                    <span>Servidor VPS:</span>
                    <span id="summary-vps">$0.00</span>
                </div>
                
                <div class="summary-item">
                    <span>Dominio Web:</span>
                    <span id="summary-domain">$0.00</span>
                </div>
                
                <div class="summary-item">
                    <span>Soporte:</span>
                    <span id="summary-support">$0.00</span>
                </div>

                <div class="summary-item">
                    <span>Config. Dispositivos:</span>
                    <span id="summary-devices">$0.00</span>
                </div>
                
                <div class="summary-item">
                    <span>Capacitación:</span>
                    <span id="summary-training">$0.00</span>
                </div>
                
                <div class="summary-total">
                    <span>TOTAL:</span>
                    <span id="total-amount">$3,800.00</span>
                </div>
                
                <div class="form-actions">
                    <button class="btn-pdf" id="generate-pdf">Generar PDF</button>
                    <button class="btn-email" id="send-email">Enviar por Email</button>
                    <button class="btn-reset" id="reset-form">Limpiar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para mensajes -->
    <div class="modal" id="message-modal">
        <div class="modal-content">
            <h3 id="modal-title">Título</h3>
            <p id="modal-message">Mensaje</p>
            <div class="modal-actions">
                <button class="btn-ok" id="modal-ok">Aceptar</button>
            </div>
        </div>
    </div>

    <!-- Loading -->
    <div class="modal" id="loading-modal">
        <div class="modal-content">
            <div class="loading">
                <div class="spinner"></div>
                <p id="loading-message">Enviando correo electrónico...</p>
            </div>
        </div>
    </div>

    <script>
        // Inicializar EmailJS
        emailjs.init("-0Na9UIY8yWZVXGac");
        
        // Precios base CORREGIDOS - ahora coinciden con los mostrados
        const prices = {
            desktop: 3800,
            mobile: 5000,
            web: 4500,
            vps: 3500,
            domain: 1000,
            support: 100,
            devices: 350,
            training: 350
        };
        
        // Elementos del DOM
        const desktopQty = document.getElementById('desktop-qty');
        const mobileQty = document.getElementById('mobile-qty');
        const webQty = document.getElementById('web-qty');
        const vpsCheck = document.getElementById('vps-check');
        const domainCheck = document.getElementById('domain-check');
        const supportCheck = document.getElementById('support-check');
        const devicesQty = document.getElementById('devices-qty');
        const trainingQty = document.getElementById('training-qty');
        
        // Elementos de resumen
        const summaryDesktop = document.getElementById('summary-desktop');
        const summaryMobile = document.getElementById('summary-mobile');
        const summaryWeb = document.getElementById('summary-web');
        const summaryVps = document.getElementById('summary-vps');
        const summaryDomain = document.getElementById('summary-domain');
        const summarySupport = document.getElementById('summary-support');
        const summaryDevices = document.getElementById('summary-devices');
        const summaryTraining = document.getElementById('summary-training');
        const totalAmount = document.getElementById('total-amount');
        
        // Elementos del modal
        const messageModal = document.getElementById('message-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalMessage = document.getElementById('modal-message');
        const modalOk = document.getElementById('modal-ok');
        const loadingModal = document.getElementById('loading-modal');
        const loadingMessage = document.getElementById('loading-message');
        
        // Función para mostrar modal
        function showModal(title, message) {
            modalTitle.textContent = title;
            modalMessage.textContent = message;
            messageModal.style.display = 'flex';
        }
        
        // Función para ocultar modal
        function hideModal() {
            messageModal.style.display = 'none';
        }
        
        // Función para mostrar loading
        function showLoading(message) {
            loadingMessage.textContent = message;
            loadingModal.style.display = 'flex';
        }
        
        // Función para ocultar loading
        function hideLoading() {
            loadingModal.style.display = 'none';
        }
        
        // Event listener para el botón OK del modal
        modalOk.addEventListener('click', hideModal);
        
        // Función para formatear moneda
        function formatCurrency(amount) {
            return '$' + amount.toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');
        }
        
        // Función para calcular el total
        function calculateTotal() {
            let total = 0;
            
            // Puntos de venta
            const desktopTotal = desktopQty.value * prices.desktop;
            const mobileTotal = mobileQty.value * prices.mobile;
            const webTotal = webQty.value * prices.web;
            
            // Servicios en la nube
            const vpsTotal = vpsCheck.checked ? prices.vps : 0;
            const domainTotal = domainCheck.checked ? prices.domain : 0;
            
            // Opciones adicionales
            const supportTotal = supportCheck.checked ? prices.support : 0;
            const devicesTotal = devicesQty.value * prices.devices;
            const trainingTotal = trainingQty.value * prices.training;
            
            // Actualizar resumen
            summaryDesktop.textContent = formatCurrency(desktopTotal);
            summaryMobile.textContent = formatCurrency(mobileTotal);
            summaryWeb.textContent = formatCurrency(webTotal);
            summaryVps.textContent = formatCurrency(vpsTotal);
            summaryDomain.textContent = formatCurrency(domainTotal);
            summarySupport.textContent = formatCurrency(supportTotal);
            summaryDevices.textContent = formatCurrency(devicesTotal);
            summaryTraining.textContent = formatCurrency(trainingTotal);
            
            // Calcular total
            total = desktopTotal + mobileTotal + webTotal + vpsTotal + domainTotal + supportTotal + devicesTotal + trainingTotal;
            totalAmount.textContent = formatCurrency(total);
            
            return total;
        }
        
        // Función para generar PDF
        function generatePDF() {
            // Verificar que haya al menos un servicio seleccionado
            const total = calculateTotal();
            if (total <= 0) {
                showModal('Error', 'Por favor, selecciona al menos un servicio con cantidad mayor a 0 para generar la cotización.');
                return;
            }
            
            // Verificar datos del cliente
            const companyName = document.getElementById('company-name').value;
            const companyRFC = document.getElementById('company-rfc').value;
            const contactName = document.getElementById('contact-name').value;
            const contactEmail = document.getElementById('contact-email').value;
            const contactPhone = document.getElementById('contact-phone').value;
            const quoteValidity = document.getElementById('quote-validity').value;
            
            if (!companyName || !companyRFC || !contactName || !contactEmail) {
                showModal('Error', 'Por favor, completa todos los datos del cliente antes de generar el PDF.');
                return;
            }
            
            // Crear instancia de jsPDF
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Configuración de la cotización
            const quoteDate = new Date().toLocaleDateString('es-MX');
            const quoteNumber = 'COT-' + new Date().getTime();
            
            // Encabezado
            doc.setFontSize(20);
            doc.setTextColor(41, 128, 185);
            doc.text('CRAZY SOFTWARE', 105, 20, { align: 'center' });
            
            doc.setFontSize(12);
            doc.setTextColor(100, 100, 100);
            doc.text('RFC: GAMM950528I59', 105, 28, { align: 'center' });
            doc.text('Calle 16 #612, Tehuacán Puebla, México', 105, 34, { align: 'center' });
            doc.text('Tel: (238) 145 86 80 | Email: remizeroaw117@gmail.com', 105, 40, { align: 'center' });
            
            // Título
            doc.setFontSize(16);
            doc.setTextColor(0, 0, 0);
            doc.text('COTIZACIÓN DE SERVICIOS', 105, 55, { align: 'center' });
            
            // Información de la cotización
            doc.setFontSize(10);
            doc.text(`Número de Cotización: ${quoteNumber}`, 20, 65);
            doc.text(`Fecha: ${quoteDate}`, 20, 71);
            doc.text(`Validez: ${quoteValidity} días`, 20, 77);
            
            // Información del cliente
            doc.setFontSize(12);
            doc.setTextColor(41, 128, 185);
            doc.text('DATOS DEL CLIENTE', 20, 90);
            
            doc.setFontSize(10);
            doc.setTextColor(0, 0, 0);
            doc.text(`Empresa: ${companyName}`, 20, 97);
            doc.text(`RFC: ${companyRFC}`, 20, 103);
            doc.text(`Contacto: ${contactName}`, 20, 109);
            doc.text(`Email: ${contactEmail}`, 20, 115);
            doc.text(`Teléfono: ${contactPhone}`, 20, 121);
            
            // Detalles de la cotización
            doc.setFontSize(12);
            doc.setTextColor(41, 128, 185);
            doc.text('DETALLES DE LA COTIZACIÓN', 20, 135);
            
            // Preparar datos para la tabla
            const tableData = [];
            
            // Puntos de venta
            if (desktopQty.value > 0) {
                tableData.push([
                    'Punto de Venta de Escritorio',
                    desktopQty.value,
                    formatCurrency(prices.desktop),
                    formatCurrency(desktopQty.value * prices.desktop)
                ]);
            }
            
            if (mobileQty.value > 0) {
                tableData.push([
                    'Punto de Venta Móvil',
                    mobileQty.value,
                    formatCurrency(prices.mobile),
                    formatCurrency(mobileQty.value * prices.mobile)
                ]);
            }
            
            if (webQty.value > 0) {
                tableData.push([
                    'Punto de Venta Web',
                    webQty.value,
                    formatCurrency(prices.web),
                    formatCurrency(webQty.value * prices.web)
                ]);
            }
            
            // Servicios en la nube
            if (vpsCheck.checked) {
                tableData.push([
                    'Servidor VPS (anual)',
                    1,
                    formatCurrency(prices.vps),
                    formatCurrency(prices.vps)
                ]);
            }
            
            if (domainCheck.checked) {
                tableData.push([
                    'Dominio Web (anual)',
                    1,
                    formatCurrency(prices.domain),
                    formatCurrency(prices.domain)
                ]);
            }
            
            // Opciones adicionales
            if (supportCheck.checked) {
                tableData.push([
                    'Soporte Técnico (hora)',
                    1,
                    formatCurrency(prices.support),
                    formatCurrency(prices.support)
                ]);
            }
            
            if (devicesQty.value > 0) {
                tableData.push([
                    'Configuración Dispositivos Adicionales',
                    devicesQty.value,
                    formatCurrency(prices.devices),
                    formatCurrency(devicesQty.value * prices.devices)
                ]);
            }
            
            if (trainingQty.value > 0) {
                tableData.push([
                    'Capacitación Personalizada',
                    trainingQty.value,
                    formatCurrency(prices.training),
                    formatCurrency(trainingQty.value * prices.training)
                ]);
            }
            
            // Agregar tabla
            doc.autoTable({
                startY: 140,
                head: [['Descripción', 'Cantidad', 'Precio Unitario', 'Importe']],
                body: tableData,
                theme: 'grid',
                headStyles: {
                    fillColor: [41, 128, 185],
                    textColor: 255,
                    fontStyle: 'bold'
                },
                styles: {
                    fontSize: 9,
                    cellPadding: 3
                },
                columnStyles: {
                    0: { cellWidth: 'auto' },
                    1: { cellWidth: 20, halign: 'center' },
                    2: { cellWidth: 30, halign: 'right' },
                    3: { cellWidth: 30, halign: 'right' }
                }
            });
            
            // Total
            const finalY = doc.lastAutoTable.finalY + 10;
            doc.setFontSize(12);
            doc.setTextColor(0, 0, 0);
            doc.text(`TOTAL: ${formatCurrency(total)}`, 150, finalY, { align: 'right' });
            
            // Notas
            doc.setFontSize(9);
            doc.setTextColor(100, 100, 100);
            doc.text('Notas:', 20, finalY + 15);
            doc.text('- Los precios no incluyen IVA.', 20, finalY + 22);
            doc.text('- Los servicios marcados como mensuales se facturarán mensualmente.', 20, finalY + 28);
            doc.text('- El dominio web y VPS tienen costo anual y deben renovarse cada año.', 20, finalY + 34);
            doc.text('- El soporte técnico es marcado como hora, depende el tiempo de la solución.', 20, finalY + 40);
            doc.text('- Esta cotización es válida por el tiempo indicado en el encabezado.', 20, finalY + 46);
            doc.text('Puede consultar nuestro cotizador de precios en: https:.', 20, finalY + 46);
            
            // Guardar PDF
            doc.save(`Cotizacion_${companyName.replace(/\s+/g, '_')}_${quoteNumber}.pdf`);
            
            showModal('Éxito', 'PDF generado correctamente.');
        }
        
        // Función para enviar por correo
        function sendEmail() {
            // Verificar que haya al menos un servicio seleccionado
            const total = calculateTotal();
            if (total <= 0) {
                showModal('Error', 'Por favor, selecciona al menos un servicio con cantidad mayor a 0 para enviar la cotización.');
                return;
            }
            
            // Verificar datos del cliente
            const companyName = document.getElementById('company-name').value;
            const companyRFC = document.getElementById('company-rfc').value;
            const contactName = document.getElementById('contact-name').value;
            const contactEmail = document.getElementById('contact-email').value;
            const contactPhone = document.getElementById('contact-phone').value;
            const quoteValidity = document.getElementById('quote-validity').value;
            
            if (!companyName || !companyRFC || !contactName || !contactEmail) {
                showModal('Error', 'Por favor, completa todos los datos del cliente antes de enviar la cotización.');
                return;
            }
            
            // Configuración de la cotización
            const quoteDate = new Date().toLocaleDateString('es-MX');
            const quoteNumber = 'COT-' + new Date().getTime();
            
            // Mostrar loading
            showLoading('Enviando cotización por correo electrónico...');
            
            // Parámetros para el correo - CORREGIDO: incluye to_email
            const templateParams = {
                to_email: contactEmail, // Campo CRÍTICO para el destinatario
                company_name: companyName,
                company_rfc: companyRFC,
                contact_name: contactName,
                contact_email: contactEmail,
                contact_phone: contactPhone,
                quote_number: quoteNumber,
                quote_date: quoteDate,
                quote_validity: quoteValidity,
                quote_total: formatCurrency(total)
            };
            
            // Enviar correo usando EmailJS
            emailjs.send('service_1lpk49j', 'template_nqsy8yl', templateParams)
                .then(function(response) {
                    hideLoading();
                    showModal('Éxito', `Cotización enviada correctamente a ${contactEmail}`);
                }, function(error) {
                    hideLoading();
                    showModal('Error', 'Hubo un problema al enviar el correo. Por favor, intenta nuevamente.');
                    console.error('Error al enviar correo:', error);
                });
        }
        
        // Función para limpiar el formulario
        function resetForm() {
            document.getElementById('company-name').value = '';
            document.getElementById('company-rfc').value = '';
            document.getElementById('contact-name').value = '';
            document.getElementById('contact-email').value = '';
            document.getElementById('contact-phone').value = '';
            document.getElementById('quote-validity').value = '30';
            
            desktopQty.value = 1;
            mobileQty.value = 0;
            webQty.value = 0;
            vpsCheck.checked = false;
            domainCheck.checked = false;
            supportCheck.checked = false;
            devicesQty.value = 0;
            trainingQty.value = 0;
            
            calculateTotal();
            
            showModal('Formulario limpiado', 'Todos los campos han sido restablecidos.');
        }
        
        // Event listeners para actualizar el total
        desktopQty.addEventListener('input', calculateTotal);
        mobileQty.addEventListener('input', calculateTotal);
        webQty.addEventListener('input', calculateTotal);
        vpsCheck.addEventListener('change', calculateTotal);
        domainCheck.addEventListener('change', calculateTotal);
        supportCheck.addEventListener('change', calculateTotal);
        devicesQty.addEventListener('input', calculateTotal);
        trainingQty.addEventListener('input', calculateTotal);
        
        // Botón para generar PDF
        document.getElementById('generate-pdf').addEventListener('click', generatePDF);
        
        // Botón para enviar por correo
        document.getElementById('send-email').addEventListener('click', sendEmail);
        
        // Botón para limpiar formulario
        document.getElementById('reset-form').addEventListener('click', resetForm);
        
        // Inicializar el cálculo
        calculateTotal();
    </script>
</body>
</html>